{% extends "base.html" %}

{% block content %}
<h2>{{ user.username }}的个人主页</h2>
<!--显示用户头像  -->
{% if user.img_path %}
<img src="{{ url_for('static', filename=user.img_path.replace('\\', '/')) }}" alt="头像" width="200" height="200">
<!--<p>头像路径: {{ user.img_path }}</p>-->
<!--<p>调试信息: {{ url_for('static', filename=user.img_path) }}</p>-->
{% else %}
<img src="{{ url_for('static', filename='/img/default_avatar.jpg') }}" alt="头像" width="200" height="200">
{% endif %}
<!--添加一个修改用户头像的按钮, 使得用户可以上传一个图像文件来修改头像 -->
{% if can_edit %}
<form method="POST" action="{{ url_for('change_img', user_id=user.id) }}" enctype="multipart/form-data">
    <input type="file" name="file" id="file">
    <input type="submit" value="上传头像">
</form>
{% endif %}



<p>真实姓名: {{ user.real_name }}</p>
<p>邮箱: {{ user.email }}</p>
<p>手机号: {{ user.phone }}</p>
<p>注册时间: {{ user.registered_on }}</p>
<p>上次登录时间: {{ user.last_login }}</p>
<p>权限等级: {{ user.permission_level }}</p>

<h3>修改个人信息</h3>
{% if can_edit %}
<form method="POST" action="{{ url_for('profile', user_id=user.id) }}">
    <label for="username">用户名:</label>
    <input type="text" name="username" id="username" value="{{ user.username }}" required>
    <br>
    <label for="password">密码:</label>
    <input type="password" name="password" id="password">
    <br>
    <label for="real_name">真实姓名:</label>
    <input type="text" name="real_name" id="real_name" value="{{ user.real_name }}">
    <br>
    <label for="email">邮箱:</label>
    <input type="email" name="email" id="email" value="{{ user.email }}">
    <br>
    <label for="phone">手机号:</label>
    <input type="text" name="phone" id="phone" value="{{ user.phone }}">
    <br>
    <input type="submit" value="保存更改">
    <h3>文件</h3>
    <a href="{{ url_for('upload') }}">上传文件</a>
    <br>
</form>
{% endif %}


<ul>
    {% for file in user.files %}
    <li><a href="{{ url_for('download', file_id=file.id) }}">{{ file.filename }}</a> (下载次数: {{ file.download_count }})</li>
    {% endfor %}
</ul>

{% if can_delete %}
<form method="POST" action="{{ url_for('delete_account', user_id=user.id) }}">
    <input type="submit" value="注销账号" onclick="return confirm('确定要注销账号吗？此操作不可恢复！')">
</form>
{% endif %}

{% endblock %}
